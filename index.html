<!DOCTYPE html>
<html>
  <head>
    <title>Choco Lava Pastry AR</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ar-js-org/ar.js@3.4.2/aframe/build/aframe-ar-nft.min.js"></script>
    <script src="https://unpkg.com/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      renderer="logarithmicDepthBuffer: true;"
    >
      <!-- Big movable Choco Lava Pastry -->
      <a-entity 
        gltf-model="chocolate_pastry_ti2jdifva_mid.glb"
        position="0 0 -2"
        rotation="0 180 0"
        scale="2 2 2"
        gesture-handler>
      </a-entity>

      <a-entity camera></a-entity>
    </a-scene>

    <!-- Gesture Handler Script -->
    <script>
      AFRAME.registerComponent("gesture-handler", {
        schema: { enabled: { default: true } },
        init: function () {
          this.handleScale = this.handleScale.bind(this);
          this.handleRotation = this.handleRotation.bind(this);
          this.el.sceneEl.addEventListener("onefingermove", this.handleRotation);
          this.el.sceneEl.addEventListener("twofingermove", this.handleScale);
        },
        handleRotation: function (event) {
          if (!this.data.enabled) return;
          this.el.object3D.rotation.y += event.detail.positionChange.x * 0.01;
          this.el.object3D.rotation.x += event.detail.positionChange.y * 0.01;
        },
        handleScale: function (event) {
          if (!this.data.enabled) return;
          var scale = this.el.object3D.scale;
          scale.multiplyScalar(1 + event.detail.spreadChange / 200);
        },
      });
    </script>
  </body>
</html>
